<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.9
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  
  <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5"> <!-- UMAMI --> <script defer src="https://umami.ahnenerbe.duckdns.org/script.js" data-website-id="c512a056-cf0b-43ad-9f5e-b4cda9a0eedf"></script> <!-- Theme Mode--> <script> const darkBtn = "Dark"; const lightBtn = "Light"; const isAutoTheme = false; const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; if (isAutoTheme) { document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme') ?? preferredTheme); } else { document.documentElement.setAttribute('data-theme', "dark"); } </script> <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)--> <script defer src="/assets/js/main.min.js"></script> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!--Favicon--> <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- KaTeX 0.16.9 --> <!-- Mermaid 10.8.0 --> <script defer src="/assets/js/vendor/mermaid.min.js"></script> <!-- Simple Jekyll Search 1.10.0 --> <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script> <!-- Google Analytics / Cookie Consent --> <script> const cookieName = 'cookie-notice-dismissed-https://vctrsnts.github.io'; const isCookieConsent = 'false'; const analyticsName = ''; const analyticsNameGA4 = ''; </script> <!-- seo tags --> <meta property="og:image" content="https://vctrsnts.github.io/assets/img/feature-img/logo_post.jpg"> <meta property="og:type" content="website" /> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Usando Watchtower | Si lo haces, hazlo bien!</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Usando Watchtower" /> <meta name="author" content="VSANTOS" /> <meta property="og:locale" content="es_ES" /> <meta name="description" content="Si quieres echarle la culpa tendreis que mirar a Angel de uGeek, a Lorenzo de Atareao.es y por ultimo a ElBlogdeLazaro porque ellos son los culpables de todas las mejoras o modificaciones que le estoy haciendo a mi servidor y esta que voy a explicar a continuación watchtower es una de ellas 😉" /> <meta property="og:description" content="Si quieres echarle la culpa tendreis que mirar a Angel de uGeek, a Lorenzo de Atareao.es y por ultimo a ElBlogdeLazaro porque ellos son los culpables de todas las mejoras o modificaciones que le estoy haciendo a mi servidor y esta que voy a explicar a continuación watchtower es una de ellas 😉" /> <link rel="canonical" href="https://vctrsnts.github.io/debian%20gnu/linux/docker/2023/01/25/usando-watchtower.html" /> <meta property="og:url" content="https://vctrsnts.github.io/debian%20gnu/linux/docker/2023/01/25/usando-watchtower.html" /> <meta property="og:site_name" content="Si lo haces, hazlo bien!" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2023-01-25T00:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Usando Watchtower" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"VSANTOS","url":"https://github.com/vctrsnts"},"dateModified":"2023-01-25T00:00:00+00:00","datePublished":"2023-01-25T00:00:00+00:00","description":"Si quieres echarle la culpa tendreis que mirar a Angel de uGeek, a Lorenzo de Atareao.es y por ultimo a ElBlogdeLazaro porque ellos son los culpables de todas las mejoras o modificaciones que le estoy haciendo a mi servidor y esta que voy a explicar a continuación watchtower es una de ellas 😉","headline":"Usando Watchtower","mainEntityOfPage":{"@type":"WebPage","@id":"https://vctrsnts.github.io/debian%20gnu/linux/docker/2023/01/25/usando-watchtower.html"},"url":"https://vctrsnts.github.io/debian%20gnu/linux/docker/2023/01/25/usando-watchtower.html"}</script> <!-- End Jekyll SEO tag --> <!-- RSS --> <link rel="alternate" type="application/atom+xml" title="Si lo haces, hazlo bien!" href="https://vctrsnts.github.io/feed.xml"/> <link type="application/atom+xml" rel="alternate" href="https://vctrsnts.github.io/feed.xml" title="Si lo haces, hazlo bien!" /> <!-- Twitter Cards --> <meta name="twitter:title" content="Usando Watchtower"> <meta name="twitter:description" content="Si quieres echarle la culpa tendreis que mirar a Angel de uGeek, a Lorenzo de Atareao.es y por ultimo a ElBlogdeLazaro porque ellos son los culpables de toda..."> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://vctrsnts.github.io/assets/img/feature-img/logo_post.jpg"> <meta name="twitter:image:alt" content="Usando Watchtower"> </head>
  <body>
    
    <header class="site-header"> <!-- Logo and title --> <div class="branding"> <a href="/"> <img alt="logo img" class="avatar" src="/assets/img/logo.png" loading="lazy"/> </a> <a class="site-title" aria-label="Si lo haces, hazlo bien!" href="/"> Si lo haces, hazlo bien! </a> </div> <!-- Toggle menu --> <nav class="clear"> <a aria-label="pull" id="pull" class="toggle" href="#"> <i class="fas fa-bars fa-lg"></i> </a> <!-- Menu --> <ul class="hide"> <li class="separator"> | </li> <li> <a class="clear" aria-label="About" title="About" href="/about/"> <span class="navbar-label ">About</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Archivo" title="Archivo" href="/archive"> <span class="navbar-label ">Archivo</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Tags" title="Tags" href="/tags/"> <i class="navbar-icon fas fa-tags" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Tags</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Search" title="Search" href="/search/"> <i class="navbar-icon fas fa-search" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Search</span> </a> </li> </ul> </nav> </header>
    <div class="content">
      <article class="feature-image" >
    <header id="main" style="">
        <div class="title-padder">
            
                <h1 id="Usando+Watchtower" class="title">Usando Watchtower</h1>
                


<div class="post-info"><a href="https://github.com/vctrsnts" target="_blank" rel="noopener">
      <img alt="Author's avatar" src="/assets/img/avatar.jpg" loading="lazy">
    
    <p class="meta">
      VSANTOS - 
      
      Enero 25, 2023
    </p></a></div>

            
        </div>
    </header>

    <section class="post-content">
    
            <p>Si quieres echarle la culpa tendreis que mirar a <a href="https://ugeek.github.io/blog/post/2019-07-26-actualizaci%C3%B3n-autom%C3%A1tica-de-tus-dockers.html" target="_blank">Angel de uGeek</a>, a <a href="https://atareao.es/podcast/como-actualizar-imagenes-docker-automaticamente" target="_blank">Lorenzo de Atareao.es</a> y por ultimo a <a href="https://elblogdelazaro.org/posts/2018-09-12-actualiza-automaticamente-tus-contenedores-docker" target="_blank">ElBlogdeLazaro</a> porque ellos son los culpables de todas las mejoras o modificaciones que le estoy haciendo a mi servidor y esta que voy a explicar a continuación <strong>watchtower</strong> es una de ellas 😉</p>

<!-- more -->

<p>No voy a explicar que hace esta aplicación, porque si leeis los articulos que <em>uGeek</em>, <em>Lorenzo</em> o <em>Lazaro</em>, estaran mejor explicadas, pero en pocas palabras, te mantiene actualizado todos los contenedores de docker, siempre que le actives el <strong>label</strong> para que <strong>watchtower</strong> los tenga en cuenta.</p>

<p>Eso si, hay que tener en cuenta que si no piensas bien que contenedores quieres que te actualize puedes liar un caos en tu servidor que puede ser de ordago.</p>

<p>Un ejemplo de este caos (yo de momento no tengo activada su auto-actualizació) es el proxy inverso (caddy), porque imaginate que se actualiza, pero da un error y ya no puedes acceder a tus servicios desde el exterior. Por eso, en mi caso pienso bien que contenedores quiero que se actualizen automaticamente.</p>

<p>Eso si, os voy a poner mi <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> que uso para la instalación de <strong>watchtower</strong>. Tener en cuenta que es una recopilación de todos los ficheros de configuración que he visto para su instalación.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">watchtower</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">containrrr/watchtower:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">watchtower</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_LABEL_ENABLE=true</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_CLEANUP=true</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_INCLUDE_RESTARTING=true</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_INCLUDE_STOPPED=true</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_REVIVE_STOPPED=false</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_NO_RESTART=false</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_TIMEOUT="30s"</span>
      <span class="c1"># AQUESTA OPCIÓ LA TINC DESACTIVADA, PERQUE TINC DUBTES DE QUE FUNCIONI CORRECTAMENT, ENCARA QUE EL LOG DONAR CONSTANCIA DE QUE SI</span>
      <span class="c1">#- WATCHTOWER_SCHEDULE=0 0 4 * * *</span>
      <span class="c1"># L'HE SUBSTITUIT PER AQUESTA</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_POLL_INTERVAL=86400</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_NOTIFICATION_URL=telegram://token_telegram@telegram/?channels=id_canal</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_NOTIFICATIONS_HOSTNAME=nombreServidor</span>
      <span class="c1">#WATCHTOWER_NOTIFICATIONS: gotify</span>
      <span class="c1">#WATCHTOWER_NOTIFICATION_GOTIFY_URL: https://gotify.tuservidor.es</span>
      <span class="c1">#WATCHTOWER_NOTIFICATION_GOTIFY_TOKEN: AAAAAAAAAAAAAAA</span>
      <span class="pi">-</span> <span class="s">WATCHTOWER_DEBUG=true</span>
      <span class="pi">-</span> <span class="s">TZ=Europe/Madrid</span>
</code></pre></div></div>

<p>Al principio, <strong>watchtower</strong> no me funcionaba correctamente, en pocas palabras no funcionaba ni hacia nada.</p>

<p>Así que me toco investigar que podia ser y al final después de mucho buscar, vi que me faltaba informar de en que red iba a trabajar el contenedor. Esto se configura de la siguiente manera:</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">network_mode</span><span class="pi">:</span> <span class="s">bridge</span>
</code></pre></div></div>

<p>Tambien hay que tener en cuenta, que para informar a <strong>watchtower</strong> de los contenedores que queremos que vigile por si tiene alguna actualización es de la siguiente manera (tener en cuenta, que tiene que estar en todos los contenedores que queremos sean controlados):</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">labels</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">com.centurylinklabs.watchtower.enable="true"</span>
</code></pre></div></div>

<p>Y en teoria ya tendria que funcionar. Al principio no parece que funcionaba y estaba con la mosca detras de la oreja, porque no me actualizada nada. Asi que le puse que se ejecutara cada minuto y al final, a partir de que configure correctamente la red empezo a funcionar, me actualizo un par de contenedores y asi quedo.</p>

<p>Se actualizo y desde entonces, no ha vuelto a actualizar ningún contenedor más. Y es la duda que tengo, no se si es porque no hay ninguna actualización o porque no esta funcionando correctamente.</p>

<p>Seguire observando si funciona correctamente.</p>

<h4 id="referencia">Referencia</h4>
<ul>
  <li><a href="https://atareao.es/podcast/como-actualizar-imagenes-docker-automaticamente/" target="_blank">Atareao.es - Watchtower</a></li>
  <li><a href="https://elblogdelazaro.org/posts/2018-09-12-actualiza-automaticamente-tus-contenedores-docker" target="_blank">ElBlogdeLazaro - Watchtower, 1 parte</a></li>
  <li><a href="https://elblogdelazaro.org/posts/2022-10-17-actualiza-automaticamente-tus-contenedores-docker-ii/https://elblogdelazaro.org/posts/2022-10-17-actualiza-automaticamente-tus-contenedores-docker-ii/https://elblogdelazaro.org/posts/2022-10-17-actualiza-automaticamente-tus-contenedores-docker-ii" target="_blank">ElBlogdeLazaro - Watchtower, 2 parte</a></li>
  <li><a href="https://ugeek.github.io/blog/post/2019-07-26-actualizaci%C3%B3n-autom%C3%A1tica-de-tus-dockers.html" target="_blank">uGeek - Watchtower</a></li>
</ul>

    
    </section>

    <!-- Social media shares -->
    
 
  




    <!-- Tag list -->
    
    


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags#Debian+GNU%2FLinux">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Debian GNU/Linux</p>
        </a></li>
      
        <li><a class="button" href="/tags#Docker">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Docker</p>
        </a></li>
      
    </ul>
  </div>



</article>




<!-- To change color of links in the page --> <style> header#main { background-size: cover; background-repeat: no-repeat; background-position: center; } header#main { background-image: url('/assets/img/feature-img/logo_post.jpg'); } </style> <!-- Post navigation --> <div id="post-nav"> <div id="previous-post"> <a alt="Mastodon, Jekyll y Github. Una combinación perfecta." href="/blog/docker/2023/02/13/jekyll-muy-configurable.html"> <p>Previous post</p> Mastodon, Jekyll y Github. Una combinación perfecta. </a> </div> <div id="next-post"> <a alt="Mis nuevos juguetes" href="/thinkpads/2023/01/23/mis-nuevos-juguetes.html"> <p>Next post</p> Mis nuevos juguetes </a> </div> </div> <!--Utterances--> <!-- Cusdis --> <!-- Disqus -->


    </div>
    
    <footer class="site-footer"> <ul> <a href="https://creativecommons.org/licenses/by-nc/4.0/deed.ca" title="This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"><i class="fab fa-creative-commons fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-by fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-nc-eu fa-stack fa-lg"></i></span> </a> </ul> <p class="text"> Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a> </p> <div class="footer-icons"> <ul> <!-- Social icons from Font Awesome, if enabled --> <li> <a feed.xml href="/feed.xml" title="Follow RSS feed" target="_blank"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://github.com/vctrsnts" title="Follow on Github" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://mastodon.online/@vsantos" title="Follow on Mastodon" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://vctrsnts.tumblr.com/" title="Follow on Tumblr" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-tumblr fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://vsantos.wordpress.com/" title="Follow on Wordpress" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-wordpress fa-stack-1x fa-inverse"></i> </span> </a> </li> </ul> </div> <script type="module"> mermaid.initialize({ startOnLoad: false, theme: "default" }); mermaid.run({ nodes: [...document.querySelectorAll('.language-mermaid'), ...document.querySelectorAll('.mermaid')] }); </script> </footer>
  </body>
</html>
