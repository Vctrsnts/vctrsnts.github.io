<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.9
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  
  <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5"> <!-- UMAMI --> <script defer src="https://umami.ahnenerbe.duckdns.org/script.js" data-website-id="fc75c192-2deb-4dd3-b2f7-82b8ce5d8199"></script> <!-- Theme Mode--> <script> const darkBtn = "Dark"; const lightBtn = "Light"; const isAutoTheme = false; const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; if (isAutoTheme) { document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme') ?? preferredTheme); } else { document.documentElement.setAttribute('data-theme', "dark"); } </script> <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)--> <script defer src="/assets/js/main.min.js"></script> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!--Favicon--> <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- KaTeX 0.16.9 --> <!-- Mermaid 10.8.0 --> <script defer src="/assets/js/vendor/mermaid.min.js"></script> <!-- Simple Jekyll Search 1.10.0 --> <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script> <!-- Google Analytics / Cookie Consent --> <script> const cookieName = 'cookie-notice-dismissed-https://vctrsnts.github.io'; const isCookieConsent = 'false'; const analyticsName = ''; const analyticsNameGA4 = ''; </script> <!-- seo tags --> <meta property="og:image" content="https://vctrsnts.github.io/assets/img/feature-img/logo_post.jpg"> <meta property="og:type" content="website" /> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Usando Traefik - 2 | Si lo haces, hazlo bien!</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Usando Traefik - 2" /> <meta name="author" content="VSANTOS" /> <meta property="og:locale" content="es_ES" /> <meta name="description" content="De nuevo, con otro articulo de Traefik, en este caso, como se instala / activa el plugin GeoBlock para asi, tal como indica su nombre, Traefik en base al pais de origen de la IP, lo bloquea o no. En este caso, igual que en el anterior articulo, partimos de la base de que tambien me encontre con problemas a la hora de poder usar este plugin, tanto en su instalaci贸n, como en su configuraci贸n. Pero como ya tenia la experiencia de instalar y activar toda la secci贸n de la redirecci贸n, esta vez, me resulto un poco m谩s facil, solo un poco, todo porque ya entendia, m谩s o menos como funcionaba traefik. Hay que tener en cuenta, que la informaci贸n, o el hilo del que tirar lo encontre gracias a nuestro querido Lorenzo (atareao) y en especial de este articulo." /> <meta property="og:description" content="De nuevo, con otro articulo de Traefik, en este caso, como se instala / activa el plugin GeoBlock para asi, tal como indica su nombre, Traefik en base al pais de origen de la IP, lo bloquea o no. En este caso, igual que en el anterior articulo, partimos de la base de que tambien me encontre con problemas a la hora de poder usar este plugin, tanto en su instalaci贸n, como en su configuraci贸n. Pero como ya tenia la experiencia de instalar y activar toda la secci贸n de la redirecci贸n, esta vez, me resulto un poco m谩s facil, solo un poco, todo porque ya entendia, m谩s o menos como funcionaba traefik. Hay que tener en cuenta, que la informaci贸n, o el hilo del que tirar lo encontre gracias a nuestro querido Lorenzo (atareao) y en especial de este articulo." /> <link rel="canonical" href="https://vctrsnts.github.io/debian%20gnu/linux/docker/vps/2024/05/13/usando-traefik-2.html" /> <meta property="og:url" content="https://vctrsnts.github.io/debian%20gnu/linux/docker/vps/2024/05/13/usando-traefik-2.html" /> <meta property="og:site_name" content="Si lo haces, hazlo bien!" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-05-13T00:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Usando Traefik - 2" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"VSANTOS","url":"https://github.com/vctrsnts"},"dateModified":"2024-05-13T00:00:00+00:00","datePublished":"2024-05-13T00:00:00+00:00","description":"De nuevo, con otro articulo de Traefik, en este caso, como se instala / activa el plugin GeoBlock para asi, tal como indica su nombre, Traefik en base al pais de origen de la IP, lo bloquea o no. En este caso, igual que en el anterior articulo, partimos de la base de que tambien me encontre con problemas a la hora de poder usar este plugin, tanto en su instalaci贸n, como en su configuraci贸n. Pero como ya tenia la experiencia de instalar y activar toda la secci贸n de la redirecci贸n, esta vez, me resulto un poco m谩s facil, solo un poco, todo porque ya entendia, m谩s o menos como funcionaba traefik. Hay que tener en cuenta, que la informaci贸n, o el hilo del que tirar lo encontre gracias a nuestro querido Lorenzo (atareao) y en especial de este articulo.","headline":"Usando Traefik - 2","mainEntityOfPage":{"@type":"WebPage","@id":"https://vctrsnts.github.io/debian%20gnu/linux/docker/vps/2024/05/13/usando-traefik-2.html"},"url":"https://vctrsnts.github.io/debian%20gnu/linux/docker/vps/2024/05/13/usando-traefik-2.html"}</script> <!-- End Jekyll SEO tag --> <!-- RSS --> <link rel="alternate" type="application/atom+xml" title="Si lo haces, hazlo bien!" href="https://vctrsnts.github.io/feed.xml"/> <link type="application/atom+xml" rel="alternate" href="https://vctrsnts.github.io/feed.xml" title="Si lo haces, hazlo bien!" /> <!-- Twitter Cards --> <meta name="twitter:title" content="Usando Traefik - 2"> <meta name="twitter:description" content="De nuevo, con otro articulo de Traefik, en este caso, como se instala / activa el plugin GeoBlock para asi, tal como indica su nombre, Traefik en base al pai..."> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://vctrsnts.github.io/assets/img/feature-img/logo_post.jpg"> <meta name="twitter:image:alt" content="Usando Traefik - 2"> </head>
  <body>
    
    <header class="site-header"> <!-- Logo and title --> <div class="branding"> <a href="/"> <img alt="logo img" class="avatar" src="/assets/img/logo.png" loading="lazy"/> </a> <a class="site-title" aria-label="Si lo haces, hazlo bien!" href="/"> Si lo haces, hazlo bien! </a> </div> <!-- Toggle menu --> <nav class="clear"> <a aria-label="pull" id="pull" class="toggle" href="#"> <i class="fas fa-bars fa-lg"></i> </a> <!-- Menu --> <ul class="hide"> <li class="separator"> | </li> <li> <a class="clear" aria-label="About" title="About" href="/about/"> <span class="navbar-label ">About</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Archivo" title="Archivo" href="/archive"> <span class="navbar-label ">Archivo</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Tags" title="Tags" href="/tags/"> <i class="navbar-icon fas fa-tags" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Tags</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Search" title="Search" href="/search/"> <i class="navbar-icon fas fa-search" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Search</span> </a> </li> </ul> </nav> </header>
    <div class="content">
      <article class="feature-image" >
    <header id="main" style="">
        <div class="title-padder">
            
                <h1 id="Usando+Traefik+-+2" class="title">Usando Traefik - 2</h1>
                


<div class="post-info"><a href="https://github.com/vctrsnts" target="_blank" rel="noopener">
      <img alt="Author's avatar" src="/assets/img/avatar.jpg" loading="lazy">
    
    <p class="meta">
      VSANTOS - 
      
      Mayo 13, 2024
    </p></a></div>

            
        </div>
    </header>

    <section class="post-content">
    
            <p>De nuevo, con otro articulo de <strong>Traefik</strong>, en este caso, como se instala / activa el plugin <strong>GeoBlock</strong> para asi, tal como indica su nombre, <strong>Traefik</strong> en base al pais de origen de la <strong>IP</strong>, lo bloquea o no.</p>

<p>En este caso, igual que en el anterior articulo, partimos de la base de que tambien me encontre con problemas a la hora de poder usar este plugin, tanto en su instalaci贸n, como en su configuraci贸n. Pero como ya tenia la experiencia de instalar y activar toda la secci贸n  de la redirecci贸n, esta vez, me resulto un poco m谩s facil, solo un poco, todo porque ya entendia, m谩s o menos como funcionaba <strong>traefik</strong>.</p>

<p>Hay que tener en cuenta, que la informaci贸n, o el hilo del que tirar lo encontre gracias a nuestro querido Lorenzo (<a href="https://atareao.es" target="_blank">atareao</a>) y en especial de este <a href="https://atareao.es/podcast/exprimiendo-tu-proxy-inverso-traefik" target="_blank">articulo</a>.</p>

<!-- more -->

<p>Para activar este plugin, lo primero es acceder a nuestra web de configuraci贸n de <strong>traefik</strong> e iremos a la secci贸n de <strong>plugins</strong> y buscamos el que queremos instalar, que en este caso es <strong>GeoBlock</strong>. Aqui hay que tener una cosa en mente, si buscamos, nos apareceran 2 plugins pero con una peque帽a diferencia. La versi贸n de cada uno:</p>
<ul>
  <li>GeoBlock v0.2.2</li>
  <li>GeoBlock v0.2.8</li>
</ul>

<p>En nuestro caso, iremos a por la documentaci贸n de la versi贸n <strong>v0.2.8</strong>, pero utilizaremos una version anterior para que nuestro sistema sea m谩s estable (en mi caso, he usado la versi贸n v0.2.5). Lo que si que podemos hacer, es cuando veamos que todo funciona correctamente, es pasar a una versi贸n superior (v0.2.6 - 7).</p>

<p>Y ahora es cuando viene la parte m谩s importante, como <strong>instalar</strong> este plugin. Para ello, nos tenemos que ir al archivo de configuraci贸n de <code class="language-plaintext highlighter-rouge">traefik.yml</code>:</p>
<h3 id="traefikyml">traefik.yml</h3>
<p>A帽adimos las lineas que <strong>instalan</strong> y <strong>activan</strong> este plugin:</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">experimental</span><span class="pi">:</span>
  <span class="na">plugins</span><span class="pi">:</span>
    <span class="na">geoBlock</span><span class="pi">:</span>
      <span class="na">moduleName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">github.com/PascalMinder/geoblock"</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">v0.2.5"</span>
</code></pre></div></div>
<p>Con esto indicamos lo siguiente:</p>
<ul>
  <li>Queremos que use el plugin que se encuentra en <strong>github.com/PascalMinder</strong>
    <ul>
      <li>Esto es asi, porque tambien tenemos la posibilidad de instalar este plugin desde local.</li>
    </ul>
  </li>
  <li>La versi贸n que usaremos, que en este caso es la versi贸n <strong>v0.2.5</strong></li>
</ul>

<p>Aqui lo importante es el nombre que le hemos dado en la configuraci贸n de <code class="language-plaintext highlighter-rouge">GeoBlock</code>, porque m谩s adelante lo usaremos y si no ponemos el mismo, tendremos problemas.</p>

<p>Una vez, ya tenemos hecho esto, pasamos a la configuraci贸n del plugin en si, que se hace desde el archivo <code class="language-plaintext highlighter-rouge">dynamic.yml</code>:</p>

<h3 id="dynamicyml">dynamic.yml</h3>

<blockquote>
  <p> Recordar que ya habiamos a帽adido la configuraci贸n del usuario y password para los servicios que nos interesan, la configuraci贸n de <strong>GeoBlock</strong> se a帽ade a continuaci贸n:</p>
</blockquote>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">http</span><span class="pi">:</span>
  <span class="c1"># EL NOMBRE DE LA SECCIN DE CONFIGURACIN DE GEOBLOCK</span>
  <span class="na">myGeoBlock</span><span class="pi">:</span>
    <span class="na">plugin</span><span class="pi">:</span>
      <span class="c1"># EL MISMO NOMBRE QUE TENEMOS EN EL ARCHIVO TRAEFIK.YML</span>
      <span class="na">geoBlock</span><span class="pi">:</span>
        <span class="na">silentStartUp</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">allowLocalRequests</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">logLocalRequests</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">logAllowedRequests</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">logApiRequests</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">api</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://get.geojs.io/v1/ip/country/{ip}"</span>
        <span class="na">cacheSize</span><span class="pi">:</span> <span class="m">15</span>
        <span class="na">forceMonthlyUpdate</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">allowUnknownCountries</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">unknownCountryApiResponse</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nil"</span>
        <span class="na">countries</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">PAISES QUE TIENEN ACCESO A NUESTROS SERVICIOS</span>
</code></pre></div></div>
<p>Esta secci贸n tiene muchas posibilidades para a帽adir, pero en mi caso, siguiendo las pautas de <strong>Lorenzo</strong> he usado las siguientes:</p>
<ul>
  <li><strong>Countries</strong>: Los paises que tienen acceso a este proxy.</li>
  <li><strong>API</strong>: Con esta opci贸n, es desde donde a partir de la IP que accede a nuestro proxy, saber de que pais es y bloquear en caso de que no sea de uno de los paises escogidos </li>
</ul>

<p>Estan son en grandres rasgos las m谩s importantes, las otras opciones podeis buscar para que sirven.</p>

<p>Una vez, que ya tenemos <strong>GeoBlock</strong> configurado, en principio, ya esta todo listo para funcionar. Pero os recomiendo que detengais el docker de <strong>traefik</strong> y lo volvais a iniciar para asegurar de que coge la nueva configuraci贸n.</p>

<blockquote>
  <p>锔 Antes de nada, voy a hacer un inciso porque, para ver si todo el sistema funciona correctamente, tenemos que acceder a los logs de <strong>traefik</strong> para ver que hace. En este caso, tenemos 2 opciones:</p>
  <ul>
    <li>Acceder directamente al contenedor de traefik y monitorizar los archivos de configuraci贸n <code class="language-plaintext highlighter-rouge">access.log</code>, <code class="language-plaintext highlighter-rouge">traefik.log</code>.</li>
    <li>Usar un peque帽o script que, de nuevo tengo que darle las gracias a <strong>Lorenzo</strong> nos permite visualizar los logs mediante una peque帽a instrucci贸n y de un contenedor</li>
  </ul>
</blockquote>

<p>El script es cuesti贸n se llama <code class="language-plaintext highlighter-rouge">dless</code> que es una variante del <code class="language-plaintext highlighter-rouge">less</code> original.</p>
<h3 id="localbindless">./local/bin/dless</h3>
<p>Que contiene lo siguiente:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nb">command</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$command</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="s2">"</span><span class="nv">$command</span><span class="s2">"</span> <span class="o">==</span> <span class="k">*</span><span class="s2">":"</span><span class="k">*</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">container</span><span class="o">=</span><span class="k">${</span><span class="nv">command</span><span class="p">%</span>:<span class="p">*</span><span class="k">}</span>
        <span class="nv">filepath</span><span class="o">=</span><span class="k">${</span><span class="nv">command</span><span class="p">##*</span>:<span class="k">}</span>

        docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="s2">"</span><span class="nv">$container</span><span class="s2">"</span> <span class="nb">tail</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$filepath</span><span class="s2">"</span>
    <span class="k">fi</span>
</code></pre></div></div>
<p>En mi caso, lo he configurado para que haga un <strong>tail -f</strong> del archivo en cuesti贸n, tu puedes poner la instrucci贸n que m谩s te guste. Yo tengo <strong>tail</strong>, porque asi puedo hacer un seguimiento del archivo en cuesti贸n.</p>

<p>Para poderlo usar, antes tenemos que modificar nuestro fichero <code class="language-plaintext highlighter-rouge">.bashrc</code> para a帽adir la ubicaci贸n del script de la siguiente manera:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>AFEGIM DLESS
<span class="gp">export PATH=~/.local/bin:$</span>PATH
</code></pre></div></div>
<p>Y para usarlo hacemos lo siguiente:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">usuari@debian:~dless traefik:/var/log/traefik/access.log
</span></code></pre></div></div>
<p>Donde:</p>
<ul>
  <li><strong>traefik</strong>: Es el contenedor al que queremos acceder</li>
  <li><strong>/var/log/traefik/access.log</strong>: La ruta y el archivo que queremos controlar.</li>
</ul>

<p>Yo, en mi caso, hice unas cuantas pruebas para ver si funcionaba correctamente. Como tengo una VPN (plugin) en el navegador, lo que hice fue activarla y indicar que a partir de ese momento, salia desde un pais no permitido para ver que pasaba. Y funcionaba correctamente, porque me denegaba el acceso, despu茅s, desconectaba la VPN o indicaba que salia de uno de los <strong>paises permitidos</strong> no tenia ningun problema y podia acceder a los servicios que tengo en este servidor.</p>

<p>Pues ya tenemos un nivel m谩s de protecci贸n para nuestro servidor.</p>

<p>Ahora solo me falta poder <strong>activar</strong> el plugin de <strong>crowdsec</strong> para traefik, pero eso ya es otro cantar. Es para el niveles avanzados y yo ahora mismo estoy en nivel intermedio, pero buscando la informaci贸n necesaria para llegar a ese nivel </p>

<h4 id="referencia">Referencia</h4>
<ul>
  <li><a href="https://atareao.es/podcast/exprimiendo-tu-proxy-inverso-traefik" target="_blank">532 - Exprimiendo tu proxy inverso Traefik</a></li>
</ul>

    
    </section>

    <!-- Social media shares -->
    
 
  




    <!-- Tag list -->
    
    


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags#Debian+GNU%2FLinux">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Debian GNU/Linux</p>
        </a></li>
      
        <li><a class="button" href="/tags#Docker">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Docker</p>
        </a></li>
      
        <li><a class="button" href="/tags#VPS">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> VPS</p>
        </a></li>
      
    </ul>
  </div>



</article>




<!-- To change color of links in the page --> <style> header#main { background-size: cover; background-repeat: no-repeat; background-position: center; } header#main { background-image: url('/assets/img/feature-img/logo_post.jpg'); } </style> <!-- Post navigation --> <div id="post-nav"> <div id="previous-post"> <a alt="Cambios en el blog - 1" href="/blog/2024/05/24/cambios-blog-1.html"> <p>Previous post</p> Cambios en el blog - 1 </a> </div> <div id="next-post"> <a alt="Usando Traefik - 1" href="/debian%20gnu/linux/docker/vps/2024/05/06/usando-traefik-1.html"> <p>Next post</p> Usando Traefik - 1 </a> </div> </div> <!--Utterances--> <!-- Cusdis --> <!-- Disqus -->


    </div>
    
    <footer class="site-footer"> <ul> <a href="https://creativecommons.org/licenses/by-nc/4.0/deed.ca" title="This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"><i class="fab fa-creative-commons fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-by fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-nc-eu fa-stack fa-lg"></i></span> </a> </ul> <p class="text"> Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a> </p> <div class="footer-icons"> <ul> <!-- Social icons from Font Awesome, if enabled --> <li> <a feed.xml href="/feed.xml" title="Follow RSS feed" target="_blank"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://github.com/vctrsnts" title="Follow on Github" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://mastodon.online/@vsantos" title="Follow on Mastodon" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://vctrsnts.tumblr.com/" title="Follow on Tumblr" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-tumblr fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://vsantos.wordpress.com/" title="Follow on Wordpress" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-wordpress fa-stack-1x fa-inverse"></i> </span> </a> </li> </ul> </div> <script type="module"> mermaid.initialize({ startOnLoad: false, theme: "default" }); mermaid.run({ nodes: [...document.querySelectorAll('.language-mermaid'), ...document.querySelectorAll('.mermaid')] }); </script> </footer>
  </body>
</html>
