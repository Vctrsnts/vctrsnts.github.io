<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.9
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="es">
  
  <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5"> <!-- UMAMI --> <script defer src="https://umami.ahnenerbe.duckdns.org/script.js" data-website-id="c512a056-cf0b-43ad-9f5e-b4cda9a0eedf"></script> <!-- MASTODON CREATOR --> <link rel="me" href="https://mastodon.online/@vsantos" /> <meta name="fediverse:creator" content="@vsantos@mastodon.online"> <!-- STYLE --> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"> <!-- Theme Mode--> <script> const darkBtn = "Dark"; const lightBtn = "Light"; const isAutoTheme = false; const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; if (isAutoTheme) { document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme') ?? preferredTheme); } else { document.documentElement.setAttribute('data-theme', "dark"); } </script> <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)--> <script defer src="/assets/js/main.min.js"></script> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!--Favicon--> <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- KaTeX 0.16.9 --> <!-- Mermaid 10.8.0 --> <script defer src="/assets/js/vendor/mermaid.min.js"></script> <!-- Simple Jekyll Search 1.10.0 --> <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script> <!-- Google Analytics / Cookie Consent --> <!-- <script> const cookieName = 'cookie-notice-dismissed-https://vctrsnts.github.io'; const isCookieConsent = 'false'; const analyticsName = ''; const analyticsNameGA4 = ''; </script> --> <!-- seo tags --> <meta property="og:image" content="https://vctrsnts.github.io/assets/img/feature-img/logo_post.jpg"> <meta property="og:type" content="website" /> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Matrix - 1. Instalaci√≥n y configuraci√≥n | Si lo haces, hazlo bien!</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Matrix - 1. Instalaci√≥n y configuraci√≥n" /> <meta name="author" content="VSANTOS" /> <meta property="og:locale" content="es_ES" /> <meta name="description" content="A partir de unos articulos de Lorenzo y de uGeek (podeis encontrar m√°s informaci√≥n en la referencia), me pico la sobre como seria tener mi propio servidor de mensajeria y poderlo utilizar para enviar las notificaciones de mis servicios y asi no depender tanto de Telegram. Y de hay viene este nuevo articulo, donde explicare todo el proceso de instalaci√≥n y uso de mi nuevo servidor Matrix en mi VPS y os aviso que no ha sido nada sencillo." /> <meta property="og:description" content="A partir de unos articulos de Lorenzo y de uGeek (podeis encontrar m√°s informaci√≥n en la referencia), me pico la sobre como seria tener mi propio servidor de mensajeria y poderlo utilizar para enviar las notificaciones de mis servicios y asi no depender tanto de Telegram. Y de hay viene este nuevo articulo, donde explicare todo el proceso de instalaci√≥n y uso de mi nuevo servidor Matrix en mi VPS y os aviso que no ha sido nada sencillo." /> <link rel="canonical" href="https://vctrsnts.github.io/docker/matrix/2025/03/25/instal-config-matrix.html" /> <meta property="og:url" content="https://vctrsnts.github.io/docker/matrix/2025/03/25/instal-config-matrix.html" /> <meta property="og:site_name" content="Si lo haces, hazlo bien!" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2025-03-25T00:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Matrix - 1. Instalaci√≥n y configuraci√≥n" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"VSANTOS","url":"https://github.com/vctrsnts"},"dateModified":"2025-03-25T00:00:00+00:00","datePublished":"2025-03-25T00:00:00+00:00","description":"A partir de unos articulos de Lorenzo y de uGeek (podeis encontrar m√°s informaci√≥n en la referencia), me pico la sobre como seria tener mi propio servidor de mensajeria y poderlo utilizar para enviar las notificaciones de mis servicios y asi no depender tanto de Telegram. Y de hay viene este nuevo articulo, donde explicare todo el proceso de instalaci√≥n y uso de mi nuevo servidor Matrix en mi VPS y os aviso que no ha sido nada sencillo.","headline":"Matrix - 1. Instalaci√≥n y configuraci√≥n","mainEntityOfPage":{"@type":"WebPage","@id":"https://vctrsnts.github.io/docker/matrix/2025/03/25/instal-config-matrix.html"},"url":"https://vctrsnts.github.io/docker/matrix/2025/03/25/instal-config-matrix.html"}</script> <!-- End Jekyll SEO tag --> <!-- RSS --> <link rel="alternate" type="application/atom+xml" title="Si lo haces, hazlo bien!" href="https://vctrsnts.github.io/feed.xml"/> <link type="application/atom+xml" rel="alternate" href="https://vctrsnts.github.io/feed.xml" title="Si lo haces, hazlo bien!" /> <!-- Twitter Cards --> <meta name="twitter:title" content="Matrix - 1. Instalaci√≥n y configuraci√≥n"> <meta name="twitter:description" content="A partir de unos articulos de Lorenzo y de uGeek (podeis encontrar m√°s informaci√≥n en la referencia), me pico la sobre como seria tener mi propio servidor de..."> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://vctrsnts.github.io/assets/img/feature-img/logo_post.jpg"> <meta name="twitter:image:alt" content="Matrix - 1. Instalaci√≥n y configuraci√≥n"> </head>
  <body>
    
    <header class="site-header"> <!-- Logo and title --> <div class="branding"> <a href="/"> <img alt="logo img" class="avatar" src="/assets/img/logo.png" loading="lazy"/> </a> <a class="site-title" aria-label="Si lo haces, hazlo bien!" href="/"> Si lo haces, hazlo bien! </a> </div> <!-- Toggle menu --> <nav class="clear"> <a aria-label="pull" id="pull" class="toggle" href="#"> <i class="fas fa-bars fa-lg"></i> </a> <!-- Menu --> <ul class="hide"> <li class="separator"> | </li> <li> <a class="clear" aria-label="Libros" title="Libros" href="https://vsantos.envs.net"> <span class="navbar-label ">Libros</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="About" title="About" href="/about/"> <span class="navbar-label ">About</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Archivo" title="Archivo" href="/archive"> <span class="navbar-label ">Archivo</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Tags" title="Tags" href="/tags/"> <i class="navbar-icon fas fa-tags" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Tags</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Search" title="Search" href="/search/"> <i class="navbar-icon fas fa-search" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Search</span> </a> </li> </ul> </nav> </header>
    <div class="content">
      <article class="feature-image" >
    <header id="main" style="">
        <div class="title-padder">
            
                <h1 id="Matrix+-+1.+Instalaci%C3%B3n+y+configuraci%C3%B3n" class="title">Matrix - 1. Instalaci√≥n y configuraci√≥n</h1>
                


<div class="post-info"><a href="https://github.com/vctrsnts" target="_blank" rel="noopener">
      <img alt="Author's avatar" src="/assets/img/avatar.jpg" loading="lazy">
    
    <p class="meta">
      VSANTOS - 
      
      Marzo 25, 2025
    </p></a></div>

            
        </div>
    </header>

    <section class="post-content">
    
            <p>A partir de unos articulos de <a href="https://atareao.es/?s=matrix" target="_blank">Lorenzo</a> y de <a href="https://ugeek.github.io" target="_blank">uGeek</a> (podeis encontrar m√°s informaci√≥n en la referencia), me pico la sobre como seria tener mi propio servidor de mensajeria y poderlo utilizar para enviar las notificaciones de mis servicios y asi no depender tanto de <em>Telegram</em>.</p>

<p>Y de hay viene este nuevo articulo, donde explicare todo el proceso de instalaci√≥n y uso de mi nuevo servidor <strong>Matrix</strong> en mi VPS y os aviso que no ha sido nada sencillo.</p>

<!-- more -->

<blockquote>
  <p>‚ö†Ô∏è Nota: Pero antes, tengo que tirarle un poco de las orejas a <strong>Lorenzo</strong>, porque la informaci√≥n que tiene puesto en su <strong>pagina web</strong> o en su repositorio de <strong>GitHub</strong> es muy floja con respecto a la instalaci√≥n y configuraci√≥n de todo lo que se necesita para su correcto uso, y eso me ha lastrado mucho a la hora de realizar toda la instalaci√≥n y configuraci√≥n. 
Porque cuando tienes algo por donde empezar, todo se hace m√°s facil y no como esta vez que ha sido como tirarte a la piscina sin saber nadar y sin flotador. Que si, he aprendido mucho, pero no es lo m√°s recomendable.
Que conste que no es ninguna recriminaci√≥n hacia <strong>Lorenzo</strong>, porque seguro que tendra algun motivo para no haberlo subido a su repositorio, pero es que ha sido como un dolor de muelas todo el proceso. üò≠</p>
</blockquote>

<p>Despu√©s del tiron de orejas, viene lo bueno, la explicaci√≥n de todo lo necesario para tener un servidor de <strong>Matrix</strong> en marcha y a pleno rendimiento, aunque aun le faltan algunas cosas que explicare en proximos articulos.</p>

<p>Lo primero es decidir que servidor de <em>Matrix</em> utilizar. Como he dicho, <strong>uGeek</strong> y <strong>Lorenzo</strong> 2 muy diferentes entre ellos, te recomiendo que leas los articulos que hablan de ello porque son muy interesantes, y estos servidores son:</p>
<ul>
  <li><em>uGeek</em>: <a href="https://github.com/matrix-org/synapse" target="_blank">Synapse</a></li>
  <li><em>Lorenzo</em>: <a href="https://conduit.rs" target="_blank">Conduit</a></li>
</ul>

<p>En principio, el que recomienda <strong>Matrix</strong> es que se use <em>Synapse</em>, pero es un poco pesado de usar para las cosas, que en mi caso quiero hacer, que son basicamente:</p>
<ul>
  <li>Un solo usuario üòÅ</li>
  <li>Solo enviara notificaciones de los servicios que tengo activos tanto en mi servidor domestico como de mi VPS.</li>
  <li>El volumen de notificaciones que tendra que enviar es muy bajo.</li>
</ul>

<p>En este caso, para este tipo de uso, segun lo que he podido leer, y <strong>atareao</strong> pone mucho enfasis en este punto, el mejor es <strong>conduit</strong> por los pocos recursos que necesita asi como los que consume.</p>

<p>Asi que en primera instancia me fui a por la instalaci√≥n de <strong>Conduit</strong> como servidor de <strong>Matrix</strong> y como he dicho, <strong>Lorenzo</strong> no lo ha puesto nada facil, porque no habia subido a su repositorio, como siempre hace, el <code class="language-plaintext highlighter-rouge">docker-compose</code> para la instalaci√≥n, y ha sido una tarea ardua y nada sencilla.</p>

<p>Eso si, lo cortes no quita lo valiente, y tengo que decir que <em>Lorenzo</em> si que puso el <code class="language-plaintext highlighter-rouge">docker-compose</code> en este <a href="https://atareao.es/podcast/crear-bots-en-matrix" target="_blank">articulo</a>, para instalar el servidor de <em>Matrix</em> y el cliente <em>Cinny</em>, pero no de la manera que nos tiene acostumbrados.</p>

<blockquote>
  <p>‚ö†Ô∏è Opini√≥n Persona: Con respecto a los articulos y m√°s concretamente los videos de <em>Lorenzo</em>, antes si explicaba todo el proceso de instalaci√≥n, <em>en plan rapido y explicaba un poco por encima lo que hace cada cosa</em>, pero ya era algo por donde empezar, ahora en los nuevos videos esto no lo hace y se hace un poco m√°s dificil ver y entender todo el conjunto. Que si, de esta manera aprendes m√°s, pero el inicio es m√°s cuesta arriba.</p>
</blockquote>

<p>Pues como iba diciendo, tenia un <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> por el que empezar a trastear y en mi caso quedo de la siguiente manera:</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">cinny</span><span class="pi">:</span>
   <span class="na">image</span><span class="pi">:</span> <span class="s">ajbura/cinny:latest</span>
   <span class="na">init</span><span class="pi">:</span> <span class="kc">true</span>
   <span class="na">container_name</span><span class="pi">:</span> <span class="s">matrixCinny</span>
   <span class="na">networks</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">internal</span>
   <span class="na">volumes</span><span class="pi">:</span>
     <span class="c1"># Es el GitHub de Cinny podeu trobar un config.json per comen√ßar</span>
     <span class="pi">-</span> <span class="s">${HOME}/config/matrix/cinny/config.json:/app/config.json</span>
   <span class="na">labels</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">traefik.enable=true</span>
     <span class="pi">-</span> <span class="s">traefik.http.services.cinny.loadbalancer.server.port=80</span>
     <span class="pi">-</span> <span class="s">traefik.http.routers.cinny-secure.entrypoints=websecure</span>
     <span class="pi">-</span> <span class="s">traefik.http.routers.cinny-secure.rule=Host(`${CINNY_SERVER}`)</span>
     <span class="pi">-</span> <span class="s">traefik.http.routers.cinny-secure.tls=true</span>
     <span class="c1"># En aquest cas, vaig trobar a falta informaci√≥ respecte al que fa exactament aquests 2 middlewares.</span>
     <span class="c1"># M√©s o menys ara tinc que clar fan, pero...</span>
     <span class="pi">-</span> <span class="s">traefik.http.routers.cinny-secure.middlewares=traefik-real-ip@file,http2https@file</span>
     <span class="pi">-</span> <span class="s">traefik.http.routers.cinny-secure.tls.certresolver=letsencrypt</span>

<span class="na">conduit</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">matrixconduit/matrix-conduit:latest</span>
  <span class="na">container_name</span><span class="pi">:</span> <span class="s">matrixConduit</span>
  <span class="na">init</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">${HOME}/config/matrix/db:/var/lib/matrix-conduit/</span>
    <span class="pi">-</span> <span class="s">${HOME}/config/matrix/conduit.toml:/conduit.toml</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">CONDUIT_CONFIG</span><span class="pi">:</span> <span class="s">/conduit.toml</span>
    <span class="na">RUST_BACKTRACE</span><span class="pi">:</span> <span class="s">full</span>
  <span class="na">networks</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">internal</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">traefik.enable=true</span>
    <span class="pi">-</span> <span class="s">traefik.http.services.conduit.loadbalancer.server.port=6167</span>
    <span class="pi">-</span> <span class="s">traefik.http.routers.conduit-secure.entrypoints=websecure</span>
    <span class="pi">-</span> <span class="s">traefik.http.routers.conduit-secure.rule=Host(`${MATRIX_SERVER}`)</span>
    <span class="pi">-</span> <span class="s">traefik.http.routers.conduit-secure.tls=true</span>
    <span class="pi">-</span> <span class="s">traefik.http.routers.conduit-secure.tls.certresolver=letsencrypt</span>
    <span class="pi">-</span> <span class="s">traefik.http.routers.conduit-secure.middlewares=cors-headers@docker</span>
    <span class="pi">-</span> <span class="s">traefik.http.middlewares.cors-headers.headers.accessControlAllowOriginList=*</span>
    <span class="pi">-</span> <span class="s">traefik.http.middlewares.cors-headers.headers.accessControlAllowHeaders=Origin, X-Requested-With, Content-Type, Accept, Authorization</span>
    <span class="pi">-</span> <span class="s">traefik.http.middlewares.cors-headers.headers.accessControlAllowMethods=GET, POST, PUT, DELETE, OPTIONS</span>

 <span class="na">well-known</span><span class="pi">:</span>
   <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
   <span class="na">container_name</span><span class="pi">:</span> <span class="s">matrixNginx</span>
   <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
   <span class="na">networks</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">internal</span>
   <span class="na">volumes</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">${HOME}/config/matrix/nginx/matrix.conf:/etc/nginx/conf.d/matrix.conf</span> <span class="c1"># the config to serve the .well-known/matrix files</span>
     <span class="pi">-</span> <span class="s">${HOME}/config/matrix/nginx/www:/var/www/</span> <span class="c1"># location of the client and server .well-known-files</span>
   <span class="na">labels</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">traefik.enable=true</span>
     <span class="pi">-</span> <span class="s">traefik.http.routers.to-matrix-wellknown.rule=Host(`${MATRIX_SERVER}`) &amp;&amp; PathPrefix(`/.well-known/matrix`)</span>
     <span class="pi">-</span> <span class="s">traefik.http.routers.to-matrix-wellknown.tls=true</span>
     <span class="pi">-</span> <span class="s">traefik.http.routers.to-matrix-wellknown.tls.certresolver=letsencrypt</span>
     <span class="pi">-</span> <span class="s">traefik.http.routers.to-matrix-wellknown.middlewares=cors-headers@docker</span>
     <span class="pi">-</span> <span class="s">traefik.http.middlewares.cors-headers.headers.accessControlAllowOriginList=*</span>
     <span class="pi">-</span> <span class="s">traefik.http.middlewares.cors-headers.headers.accessControlAllowHeaders=Origin, X-Requested-With, Content-Type, Accept, Authorization</span>
     <span class="pi">-</span> <span class="s">traefik.http.middlewares.cors-headers.headers.accessControlAllowMethods=GET, POST, PUT, DELETE, OPTIONS</span>
</code></pre></div></div>
<p>Esto es el <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> como ya he dicho, para <em>Cinny</em>, <em>Conduit</em> y <em>WellKnown</em> (Nginx), este ultimo, por lo que he ido leyendo, entiendo que se usa m√°s para todas las funcionalidades de cuando tu servidor de <em>matrix</em> esta federado con el resto de servidores, pero que en teoria, para un uso normal no haria falta, pero si lo usa <em>Lorenzo</em> seguramente algo se me escapa. <em>Donde manda patron, no manda marinero</em>.</p>

<p>Asi mismo, a parte del <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> tambien se tienen que hacer unas modificaciones en el <strong>proxy</strong> que estes utilizando, que en mi caso es <strong>traefik</strong>. Las modificaciones que se tienen que hacer en el fichero <code class="language-plaintext highlighter-rouge">traefik.yml</code> son:</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">experimental</span><span class="pi">:</span>
  <span class="na">plugins</span><span class="pi">:</span>
    <span class="na">geoBlock</span><span class="pi">:</span>
      <span class="na">moduleName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">github.com/PascalMinder/geoblock"</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">v0.2.5"</span>
    <span class="na">traefik-real-ip</span><span class="pi">:</span>
      <span class="na">modulename</span><span class="pi">:</span> <span class="s">github.com/soulbalz/traefik-real-ip</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s">v1.0.3</span>
</code></pre></div></div>
<p>Y a continuaci√≥n la modificaci√≥n que se tiene que hacer en <code class="language-plaintext highlighter-rouge">dynamic.yml</code>:</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">http</span><span class="pi">:</span>
  <span class="na">middlewares</span><span class="pi">:</span>
    <span class="na">http2https</span><span class="pi">:</span>
      <span class="na">redirectScheme</span><span class="pi">:</span>
        <span class="na">scheme</span><span class="pi">:</span> <span class="s">https</span>
        <span class="na">permanent</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">traefik-real-ip</span><span class="pi">:</span>
      <span class="na">plugin</span><span class="pi">:</span>
        <span class="na">traefik-real-ip</span><span class="pi">:</span>
          <span class="na">excludednets</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s2">"</span><span class="s">1.1.1.1/24"</span>

    <span class="na">cors-headers</span><span class="pi">:</span>
      <span class="na">headers</span><span class="pi">:</span>
        <span class="na">accessControlAllowOriginList</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
        <span class="na">accessControlAllowHeaders</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">Origin"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">X-Requested-With"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">Content-Type"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">Accept"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">Authorization"</span>
        <span class="na">accessControlAllowMethods</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">GET"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">POST"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">PUT"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">DELETE"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">OPTIONS"</span>
          
  <span class="na">routers</span><span class="pi">:</span>
    <span class="na">conduit-secure</span><span class="pi">:</span>
      <span class="na">rule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Host(`${MATRIX_SERVER}`)"</span>
      <span class="na">entryPoints</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">websecure"</span>
      <span class="c1"># Servico docker del Servidor de Matrix, en mi caso, Conduit</span>
      <span class="na">service</span><span class="pi">:</span> <span class="s2">"</span><span class="s">conduit"</span>
      <span class="na">tls</span><span class="pi">:</span>
        <span class="na">certResolver</span><span class="pi">:</span> <span class="s2">"</span><span class="s">letsencrypt"</span>

  <span class="na">services</span><span class="pi">:</span>
    <span class="na">conduit</span><span class="pi">:</span>
      <span class="na">loadBalancer</span><span class="pi">:</span>
        <span class="na">servers</span><span class="pi">:</span>
          <span class="c1"># URL del servicio de Conduit</span>
          <span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://conduit:6167"</span>
</code></pre></div></div>
<p>Y con esto, ya tendria que funcionar sin ningun problema nuestro <em>servidor de Matrix</em>. En principio es asi, pero ahora es cuando te das de bruzes con la realidad.</p>

<p>Lo primero es ver que si envias un mensaje desde la consola, este llegue correctamente a tu servidor y aqui es cuando empezaron mis problemas y eso que el script es facil. Encontre miles de los scripts. Pero la diferencia que habia entre unos y otros, es que unos hacian uso de <em>POST</em>, que es la versi√≥n antigua para enviar los mensajes, y otros usaban el <em>PUT</em> que es la versi√≥n m√°s actual y que todos los servidores de <em>matrix</em> acceptan.</p>

<p>No os podeis imaginar la de problemas que tenia.</p>

<p>Llegue hasta un punto de eliminar el servidor de <strong>Conduit</strong> y probar con <strong>Synapse</strong> a ver si el problema radicaba es eso. Tambien hice multiples modificaciones a los ficheros de traefik (<code class="language-plaintext highlighter-rouge">traefik.yml</code> y <code class="language-plaintext highlighter-rouge">dynamic.yml</code>) y no conseguia que nada funcionase. El problema no estaba en el servidor que utilizase, sino m√°s bien, en el <em>script</em>. Aqui fue donde si que pedi ayuda a <em>Lorenzo</em> porque no sabia por donde salir y fue cuando me paso el <em>script</em> que lo soluciono todo y que pongo a continuaci√≥n:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="o">!</span> /bin/bash
<span class="go">
MATRIX_SERVER="https://matrix.myserver.org"
TOKEN="TOKEN_MATRIX"
ROOM_ID="ROOM_ID:matrix.myserver.org"

curl -XPUT \
</span><span class="gp">    -H "Authorization: Bearer $</span><span class="o">{</span>TOKEN<span class="o">}</span><span class="s2">"</span><span class="se">\</span><span class="s2">
</span><span class="go">    -H "Content-Type: application/json"\
    -d '{"msgtype":"m.text","body":"hello world"}' \
</span><span class="gp">    "https://$</span><span class="o">{</span>MATRIX_SERVER<span class="o">}</span>/_matrix/client/v3/rooms/<span class="k">${</span><span class="nv">ROOM_ID</span><span class="k">}</span>:<span class="k">${</span><span class="nv">MATRIX_SERVER</span><span class="k">}</span>/send/m.room.message/<span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%s%3N'</span><span class="si">)</span><span class="s2">"
</span></code></pre></div></div>
<p>Con este simple <em>script</em> todo volvio a la vida y yo por fin podia ver la luz al final del camino.</p>

<p>No pare de enviar mensajes desde la consola al cliente, desde el cliente al movil, desde el movil al cliente y ahora si, todo funcionaba correctamente.</p>

<p>Lo unico que no me acababa de funcionar bien, era el tema de enviar imagenes, esto viene porque en una de las tareas que quiero usar, es necesario enviar imagenes, y no habia manera de que el cliente del portatil se pudieran ver las imagenes. En cambio en el movil si que las veia.</p>

<p>Para que veais lo frustante que es, llegue a probar todos los clientes habidos y por haber a traves de web y en todos me pasaba lo mismo. Me pase 3 dias peleando contra esto y en todos me daba de bruces contra la pared. Hasta que se me ocurrio la brillante idea üí°, porque no lo hice antes, de preguntar en el foro de <em>Conduit</em>. Lo que me respondieron era para darme de collejas hasta en el carnet de identidad. La pregunta era muy simple, <em>tienes el navegador en modo incognito</em> ü§Ø</p>

<p>No me lo podia creer, no podia ser que por estar con esta configuraci√≥n no se vieran las imagenes, pues ya os lo podeis imaginar. Si por esta tonteria no se pueden ver las imagenes. Desactive esa opci√≥n y las imagenes que enviaba las podia ver si problemas en el cliente de mi portatil ü§¨.</p>

<p>Llevaba 3 dias intentando solucionar este problema y todo era por culpa del navegador <em>Firefox</em> que me estaba apu√±alando por la espalda. Que es culpa mia porque podia haberlo preguntado antes, pero quien iba a pensar que por estar en <em>modo incognito</em> se bloquearan las imagenes. Una cosa m√°s que ya tenia solucionada.</p>

<p>Lo unico que me faltaba era que los servicios pudieran enviar imagenes pero esto, ya os puedo decir que hasta donde yo se, no es posible, porque por lo que he llegado a entender, y eso que he hecho miles de pruebas, y he leido mucho sobre este tema, es que primero se tiene que enviar la imagen al servidor de <em>matrix</em>, para que te de una especie de <em>URL</em>, m√°s concretamente un <strong>MXC</strong> y luego con esta direcci√≥n tu ya puedes enviar un mensaje con esa imagen adjunta. Y no todos los servicios con los que se puede usar <em>matrix</em> tienen ese tipo de funcionalidad implementada.</p>

<p>Aunque <em>matrix</em> mismo podria cambiar esta manera de funcionar y funcionar de la misma manera de <em>Telegram</em>, <em>Discord</em> o <em>Slack</em>.</p>

<p>Pero bueno, ya podia hacer funcionar correctamente mi servidor de matrix y podia enviar y recibir mensajes entre mis diferentes dispositivos.</p>

<p>Ahora solamente queda la opci√≥n de sacarle jugo al nuevo servico. Pero esto ya lo explicare en otro articulo que este me parece que ya se esta haciendo muy largo. Porque tambi√©n os tengo que decir que tuve que sudar sangre y lagrimas para conseguir lo que yo queria.</p>

<h4 id="referencia">Referencia</h4>
<ul>
  <li><a href="https://atareao.es/podcast/crear-bots-en-matrix" target="_blank">535 - Crear bots en Matrix</a></li>
  <li><a href="https://atareao.es/podcast/de-mattermost-a-matrix" target="_blank">522 - De Mattermost a Matrix</a></li>
  <li><a href="https://ugeek.github.io/blog/post/2022-07-11-conduit-el-matrix-escrito-en-rust.html" target="_blank">Conduit. El matrix escrito en rust</a></li>
  <li><a href="https://ugeek.github.io/blog/post/2021-01-28-servidor-de-mensajeria-matrix-synapse-en-raspberry-ubuntu-debian--con-docker.html" target="_blank">Servidor de mensajer√≠a Matrix Synapse, en Raspberry, Ubuntu, Debian‚Ä¶ con Docker</a></li>
  <li><a href="https://cinny.in" target="_blank">Cinny</a></li>
  <li><a href="https://github.com/matrix-org/synapse" target="_blank">Synapse</a></li>
  <li><a href="https://conduit.rs" target="_blank">Conduit</a></li>
</ul>

    
    </section>

    <!-- Social media shares -->
    




    <!-- Tag list -->
    
    


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags#Docker">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Docker</p>
        </a></li>
      
        <li><a class="button" href="/tags#Matrix">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Matrix</p>
        </a></li>
      
    </ul>
  </div>



</article>




<!-- To change color of links in the page --> <style> header#main { background-size: cover; background-repeat: no-repeat; background-position: center; } header#main { background-image: url('/assets/img/feature-img/logo_post.jpg'); } </style> <!-- Post navigation --> <div id="post-nav"> <div id="previous-post"> <a alt="Matrix - 2. PushBits, la pasarela que faltaba" href="/docker/matrix/2025/03/28/pushbits.html"> <p>Previous post</p> Matrix - 2. PushBits, la pasarela que faltaba </a> </div> <div id="next-post"> <a alt="Historia del cambio de terminal" href="/debian%20gnu/linux/2025/01/13/cambiando-a-wezterm.html"> <p>Next post</p> Historia del cambio de terminal </a> </div> </div> <!--Utterances--> <!-- Cusdis --> <!-- Disqus -->


    </div>
    
    <footer class="site-footer"> <ul> <a href="https://creativecommons.org/licenses/by-nc/4.0/deed.ca" title="This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"><i class="fab fa-creative-commons fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-by fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-nc-eu fa-stack fa-lg"></i></span> </a> </ul> <p class="text"> Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a> </p> <div class="footer-icons"> <ul> <!-- Social icons from Font Awesome, if enabled --> <li> <a feed.xml href="/feed.xml" title="Follow RSS feed" target="_blank"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://github.com/vctrsnts" title="Follow on Github" target="_blank" rel="me"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://mastodon.online/@vsantos" title="Follow on Mastodon" target="_blank" rel="me"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://vctrsnts.tumblr.com/" title="Follow on Tumblr" target="_blank" rel="me"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-tumblr fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://bsky.app/profile/vctrsnts.bsky.social" title="Follow on Bluesky" target="_blank" rel="me"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-bluesky fa-stack-1x fa-inverse"></i> </span> </a> </li> </ul> </div> <script type="module"> mermaid.initialize({ startOnLoad: false, theme: "default" }); mermaid.run({ nodes: [...document.querySelectorAll('.language-mermaid'), ...document.querySelectorAll('.mermaid')] }); </script> </footer>
  </body>
</html>
