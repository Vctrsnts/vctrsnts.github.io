<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.9
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  
  <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5"> <!-- Theme Mode--> <script> const darkBtn = "Dark"; const lightBtn = "Light"; const isAutoTheme = false; const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; if (isAutoTheme) { document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme') ?? preferredTheme); } else { document.documentElement.setAttribute('data-theme', "dark"); } </script> <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)--> <script defer src="/assets/js/main.min.js"></script> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!--Favicon--> <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- KaTeX 0.16.9 --> <!-- Mermaid 10.8.0 --> <script defer src="/assets/js/vendor/mermaid.min.js"></script> <!-- Simple Jekyll Search 1.10.0 --> <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script> <!-- Google Analytics / Cookie Consent --> <script> const cookieName = 'cookie-notice-dismissed-https://vctrsnts.github.io'; const isCookieConsent = 'false'; const analyticsName = ''; const analyticsNameGA4 = ''; </script> <!-- seo tags --> <meta property="og:image" content="https://vctrsnts.github.io/assets/img/header/logo.png"> <meta property="og:type" content="website" /> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Donde dije digo, digo Diego | Si lo haces, hazlo bien!</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Donde dije digo, digo Diego" /> <meta name="author" content="VSANTOS" /> <meta property="og:locale" content="es_ES" /> <meta name="description" content="Mucha gente pensara que me he vuelto loco al poner este titulo a este articulo y más siendo un blog de tecnologia, pero cuando llegueis al final lo entendereis." /> <meta property="og:description" content="Mucha gente pensara que me he vuelto loco al poner este titulo a este articulo y más siendo un blog de tecnologia, pero cuando llegueis al final lo entendereis." /> <link rel="canonical" href="https://vctrsnts.github.io/docker/2023/04/29/donde-dije-digo-digo-diego.html" /> <meta property="og:url" content="https://vctrsnts.github.io/docker/2023/04/29/donde-dije-digo-digo-diego.html" /> <meta property="og:site_name" content="Si lo haces, hazlo bien!" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2023-04-29T00:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Donde dije digo, digo Diego" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"VSANTOS","url":"https://github.com/vctrsnts"},"dateModified":"2023-04-29T00:00:00+00:00","datePublished":"2023-04-29T00:00:00+00:00","description":"Mucha gente pensara que me he vuelto loco al poner este titulo a este articulo y más siendo un blog de tecnologia, pero cuando llegueis al final lo entendereis.","headline":"Donde dije digo, digo Diego","mainEntityOfPage":{"@type":"WebPage","@id":"https://vctrsnts.github.io/docker/2023/04/29/donde-dije-digo-digo-diego.html"},"url":"https://vctrsnts.github.io/docker/2023/04/29/donde-dije-digo-digo-diego.html"}</script> <!-- End Jekyll SEO tag --> <!-- RSS --> <link rel="alternate" type="application/atom+xml" title="Si lo haces, hazlo bien!" href="https://vctrsnts.github.io/feed.xml"/> <link type="application/atom+xml" rel="alternate" href="https://vctrsnts.github.io/feed.xml" title="Si lo haces, hazlo bien!" /> <!-- Twitter Cards --> <meta name="twitter:title" content="Donde dije digo, digo Diego"> <meta name="twitter:description" content="Mucha gente pensara que me he vuelto loco al poner este titulo a este articulo y más siendo un blog de tecnologia, pero cuando llegueis al final lo entendere..."> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://vctrsnts.github.io/assets/img/header/triangular.jpeg"> <meta name="twitter:image:alt" content="Donde dije digo, digo Diego"> </head>
  <body>
    
    <header class="site-header"> <!-- Logo and title --> <div class="branding"> <a href="/"> <img alt="logo img" class="avatar" src="/assets/img/logo.png" loading="lazy"/> </a> <a class="site-title" aria-label="Si lo haces, hazlo bien!" href="/"> Si lo haces, hazlo bien! </a> </div> <!-- Toggle menu --> <nav class="clear"> <a aria-label="pull" id="pull" class="toggle" href="#"> <i class="fas fa-bars fa-lg"></i> </a> <!-- Menu --> <ul class="hide"> <li class="separator"> | </li> <li> <a class="clear" aria-label="About" title="About" href="/about/"> <span class="navbar-label ">About</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Archivo" title="Archivo" href="/archive"> <span class="navbar-label ">Archivo</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Tags" title="Tags" href="/tags/"> <i class="navbar-icon fas fa-tags" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Tags</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Search" title="Search" href="/search/"> <i class="navbar-icon fas fa-search" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Search</span> </a> </li> </ul> </nav> </header>
    <div class="content">
      <article >
    <header id="main" style="">
        <div class="title-padder">
            
                <h1 id="Donde+dije+digo%2C+digo+Diego" class="title">Donde dije digo, digo Diego</h1>
                


<div class="post-info"><a href="https://github.com/vctrsnts" target="_blank" rel="noopener">
      <img alt="Author's avatar" src="https://avatars2.githubusercontent.com/u/816965?s=460&v=4" loading="lazy">
    
    <p class="meta">
      VSANTOS - 
      
      Abril 29, 2023
    </p></a></div>

            
        </div>
    </header>

    <section class="post-content">
    
            <p>Mucha gente pensara que me he vuelto loco al poner este titulo a este articulo y más siendo un blog de tecnologia, pero cuando llegueis al final lo entendereis.</p>

<!-- more -->

<p>Todo empieza, si leeis este <a href="/docker/2023/02/19/actualizacion-watchtower.html">articulo</a> donde comentaba que habia probado <strong>watchtower</strong> para mantenerlos actualizados sin mi supervisión y que solo me avisara cuando se hubiera actualizado uno.</p>

<p>También comentaba como que resultada un poco lioso su configuración (fichero docker) y que volvia a <strong>diun</strong> para luego volver a <strong>watchtower</strong> para quedarme en el.</p>

<p>Pues ahora resulta, por eso el titulo de este articulo, donde dije <strong>watchtower</strong> ahora digo <strong>diun</strong>. Y el motivo es muy simple.</p>

<p>Tan simple que fue, porque después una actualización, algunos de los <code class="language-plaintext highlighter-rouge">dockers/containers</code> que uso dejaron de funcionar. Los contenedores tenian errores, que como se actualizaron sin mi supervisión, dejaron de funcionar. Y menos mal que lo descubri pronto, porque sino, no se lo que hubiera pasado. Se que estoy exagerando un poco, mi servidor no es la NASA, pero bueno, es mi servidor.</p>

<p>Y eso que ya estaba prevenido con ello, porque todos los articulos que lei sobre <strong>watchtower</strong> te avisan que hay que tener un control sobre las actualizaciones, porque pueden ocasionar un desastre y sino estas atento no te daras cuenta hasta que sea muy tarde.</p>

<p>Descubri que la ultima actualización no habia ido correctamente, porque normalmente recibo mensajes de las acciones que hace el docker y ese dia no recibi ninguna alerta a traves de Telegram, y aqui es donde me puse a investigar, para descubrir porque no estaba recibiendo las alertas y todo era culpa de que el container no estaba funcionando correctamente, este tenia un error que hacia que se reiniciase todo el rato con todo lo que ello provoca. Y ya me veis anulando la actualización y volviendo a la versión anterior.</p>

<p>Después de esta mala experiencia, aunque ya la sabia, porque el podcaster <strong>Atareao</strong> la habia comentado en su articulo donde el explicaba que estaba usando <strong>watchtower</strong>, pero yo pensaba, iluso de mi, que para los dockers tan simples que uso, no tendria que pasar nada. Pues no veas si no paso.</p>

<p>Me puse a buscar a ver que decia la gente cual era la mejor opción para substituir a <strong>watchtower</strong>. Muchos decian que el mejor era <strong>diun</strong> y si además, los creadores de muchas de las imagenes que uso <strong>linuxservers</strong> te aconsejan no usar <strong>watchtower</strong> sino que usar <strong>diun</strong>, pues me fui a por ello.</p>

<p>La instalación es muy simple, como siempre en docker:</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">diun</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">crazymax/diun:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">diun</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">nomDelTeuServidor</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">${STORAGE}/config/diun:/data</span>
      <span class="c1"># FITXER ON ESTA LA CONFIGURACIÓ AMB TELEGRAM</span>
      <span class="c1"># I ELS MISSATGES D'ALERTA QUE ENVIA QUANT TE DOCKER PER ACTUALIZAR</span>
      <span class="pi">-</span> <span class="s">${STORAGE}/config/diun/diun.yml:/diun.yml:ro</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">TZ=Europe/Madrid"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">LOG_LEVEL=info"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">LOG_JSON=false"</span>
</code></pre></div></div>

<p>El problema viene luego en la configuración de las alertas, que en mi caso las recibo a traves de <strong>Telegram</strong> aunque tienes más opciones donde recibirlas, no es complicado si sigues el manual que tienen para ello, tienes que configurar las alertas que vas a recibir (que esta todo en un fichero <strong>yaml</strong>):</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># LA BBDD DE DIUN</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">diun.db</span>
  <span class="c1"># EL CRON DE DIUN</span>
  <span class="na">watch</span><span class="pi">:</span>
    <span class="na">workers</span><span class="pi">:</span> <span class="m">20</span>
<span class="c1">#    schedule: "*/1 * * * *"</span>
    <span class="na">schedule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">@weekly"</span>
    <span class="na">firstCheckNotif</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="c1"># QUE QUIN SERVIDOR (ES POT DIR AIXI) OBTING ELS DOCKERS</span>
  <span class="na">providers</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="na">watchByDefault</span><span class="pi">:</span> <span class="kc">false</span>
      <span class="na">watchStopped</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="c1"># CONFIGURACIO DE TELEGRAM</span>
  <span class="c1"># I DEL MISSATGE QUE S'ENVIA</span>
  <span class="na">notif</span><span class="pi">:</span>
    <span class="na">telegram</span><span class="pi">:</span>
      <span class="na">token</span><span class="pi">:</span> <span class="s">TOKEN_TELEGRAM</span>
      <span class="na">chatIDs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">ID_DEL_CHAT_DE_TELEGRAM</span>
      <span class="na">templateBody</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s"># AQUI TEORICAMENT HAURIA D'ENVIAR EL LOGO DE DIUN, PERO NO HO FA</span>
        <span class="s">[Image]()</span>
        <span class="s"># AQUI ES ON TINC EL PROBLEMA I DE MOMENT NO HO POSSO PERQUE NO PORTI A PROBLEMES</span>
</code></pre></div></div>
<p>Con esto, solamente te falta hacer un:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">usuari@debian:~#</span><span class="w"> </span>docker-compose up <span class="nt">-d</span> diun
</code></pre></div></div>

<p>Y ya lo tenemos todo funcionando.</p>

<p>Esto no es del todo cierto, porque aun falta por indicar/señalar que contenedores quieres que <strong>diun</strong> controle/vigile por si ha habido actualización y esto se hace añadiendo el siguiente codigo en tu <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">labels</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">diun.enable=true</span>
</code></pre></div></div>

<p>Aunque en mi caso, no es asi. Ahora mismo lo tengo a un 80% de funcionamiento, porque segun el manual, por lo que yo he podido entender, puedes enviar imagenes, para que las alertas sean más amigables y te indiquen de que container es.</p>

<p>Pero parece ser que esto no funciona del todo correctamente, aunque se que es posible enviar imagenes a Telegram, porque en las notificaciones que tengo en <a href="/docker/raspberry%20pi%20os/2021/05/30/flexget-podcast.html">flexget</a> lo tengo puesto y las recibo sin ningun problema, pero en cambio con <strong>diun</strong> no funciona. Tendre que seguir investigando el motivo por el que no funciona.</p>

<h4 id="referencia">Referencia</h4>
<ul>
  <li><a href="https://atareao.es/podcast/como-actualizar-imagenes-docker-automaticamente">Como actualizar imagenes docker automaticamente</a></li>
</ul>

    
    </section>

    <!-- Social media shares -->
    
 
  




    <!-- Tag list -->
    
    


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tag</li>
      

      
        <li><a class="button" href="/tags#Docker">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Docker</p>
        </a></li>
      
    </ul>
  </div>



</article>




<!-- To change color of links in the page --> <style> header#main { background-size: cover; background-repeat: no-repeat; background-position: center; } </style> <!-- Post navigation --> <div id="post-nav"> <div id="previous-post"> <a alt="Recuperando Grub" href="/debian%20gnu/linux/2023/05/05/recuperando-grub.html"> <p>Previous post</p> Recuperando Grub </a> </div> <div id="next-post"> <a alt="Cambiando watchtower por diun y vuelta a watchtower" href="/docker/2023/02/19/actualizacion-watchtower.html"> <p>Next post</p> Cambiando watchtower por diun y vuelta a watchtower </a> </div> </div> <!--Utterances--> <!-- Cusdis --> <!-- Disqus -->


    </div>
    
    <footer class="site-footer"> <ul> <a href="https://creativecommons.org/licenses/by-nc/4.0/deed.ca" title="This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"><i class="fab fa-creative-commons fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-by fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-nc-eu fa-stack fa-lg"></i></span> </a> </ul> <p class="text"> Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a> </p> <div class="footer-icons"> <ul> <!-- Social icons from Font Awesome, if enabled --> <li> <a feed.xml href="/feed.xml" title="Follow RSS feed" target="_blank"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://github.com/vctrsnts" title="Follow on Github" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://mastodon.online/@vsantos" title="Follow on Mastodon" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://vctrsnts.tumblr.com/" title="Follow on Tumblr" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-tumblr fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://vsantos.wordpress.com/" title="Follow on Wordpress" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-wordpress fa-stack-1x fa-inverse"></i> </span> </a> </li> </ul> </div> <script type="module"> mermaid.initialize({ startOnLoad: false, theme: "default" }); mermaid.run({ nodes: [...document.querySelectorAll('.language-mermaid'), ...document.querySelectorAll('.mermaid')] }); </script> </footer>
  </body>
</html>
