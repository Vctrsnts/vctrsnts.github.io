<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.9
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  
  <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5"> <!-- Umami Web --> <script defer src="https://umami.ahnenerbe.duckdns.org/script.js" data-website-id="fc75c192-2deb-4dd3-b2f7-82b8ce5d8199"></script> <!-- Theme Mode--> <script> const darkBtn = "Dark"; const lightBtn = "Light"; const isAutoTheme = false; const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; if (isAutoTheme) { document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme') ?? preferredTheme); } else { document.documentElement.setAttribute('data-theme', "dark"); } </script> <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)--> <script defer src="/assets/js/main.min.js"></script> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!--Favicon--> <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- KaTeX 0.16.9 --> <!-- Mermaid 10.8.0 --> <script defer src="/assets/js/vendor/mermaid.min.js"></script> <!-- Simple Jekyll Search 1.10.0 --> <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script> <!-- Google Analytics / Cookie Consent --> <script> const cookieName = 'cookie-notice-dismissed-https://vctrsnts.github.io'; const isCookieConsent = 'false'; const analyticsName = ''; const analyticsNameGA4 = ''; </script> <!-- seo tags --> <meta property="og:image" content="https://vctrsnts.github.io/assets/img/feature-img/logo_post.jpg"> <meta property="og:type" content="website" /> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Raspberry Pi. Haciendo copias de seguridad | Si lo haces, hazlo bien!</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Raspberry Pi. Haciendo copias de seguridad" /> <meta name="author" content="VSANTOS" /> <meta property="og:locale" content="es_ES" /> <meta name="description" content="Otro capitulo más con respecto a la configuración de de mi RPI4, en este caso son las copias de seguridad de la información más importante." /> <meta property="og:description" content="Otro capitulo más con respecto a la configuración de de mi RPI4, en este caso son las copias de seguridad de la información más importante." /> <link rel="canonical" href="https://vctrsnts.github.io/docker/raspberry%20pi%20os/2021/01/17/rpi-copias-seguridad.html" /> <meta property="og:url" content="https://vctrsnts.github.io/docker/raspberry%20pi%20os/2021/01/17/rpi-copias-seguridad.html" /> <meta property="og:site_name" content="Si lo haces, hazlo bien!" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2021-01-17T00:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Raspberry Pi. Haciendo copias de seguridad" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"VSANTOS","url":"https://github.com/vctrsnts"},"dateModified":"2021-01-17T00:00:00+00:00","datePublished":"2021-01-17T00:00:00+00:00","description":"Otro capitulo más con respecto a la configuración de de mi RPI4, en este caso son las copias de seguridad de la información más importante.","headline":"Raspberry Pi. Haciendo copias de seguridad","mainEntityOfPage":{"@type":"WebPage","@id":"https://vctrsnts.github.io/docker/raspberry%20pi%20os/2021/01/17/rpi-copias-seguridad.html"},"url":"https://vctrsnts.github.io/docker/raspberry%20pi%20os/2021/01/17/rpi-copias-seguridad.html"}</script> <!-- End Jekyll SEO tag --> <!-- RSS --> <link rel="alternate" type="application/atom+xml" title="Si lo haces, hazlo bien!" href="https://vctrsnts.github.io/feed.xml"/> <link type="application/atom+xml" rel="alternate" href="https://vctrsnts.github.io/feed.xml" title="Si lo haces, hazlo bien!" /> <!-- Twitter Cards --> <meta name="twitter:title" content="Raspberry Pi. Haciendo copias de seguridad"> <meta name="twitter:description" content="Otro capitulo más con respecto a la configuración de de mi RPI4, en este caso son las copias de seguridad de la información más importante.Tal como he dicho ..."> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://vctrsnts.github.io/assets/img/feature-img/logo_post.jpg"> <meta name="twitter:image:alt" content="Raspberry Pi. Haciendo copias de seguridad"> </head>
  <body>
    
    <header class="site-header"> <!-- Logo and title --> <div class="branding"> <a href="/"> <img alt="logo img" class="avatar" src="/assets/img/logo.png" loading="lazy"/> </a> <a class="site-title" aria-label="Si lo haces, hazlo bien!" href="/"> Si lo haces, hazlo bien! </a> </div> <!-- Toggle menu --> <nav class="clear"> <a aria-label="pull" id="pull" class="toggle" href="#"> <i class="fas fa-bars fa-lg"></i> </a> <!-- Menu --> <ul class="hide"> <li class="separator"> | </li> <li> <a class="clear" aria-label="About" title="About" href="/about/"> <span class="navbar-label ">About</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Archivo" title="Archivo" href="/archive"> <span class="navbar-label ">Archivo</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Tags" title="Tags" href="/tags/"> <i class="navbar-icon fas fa-tags" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Tags</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Search" title="Search" href="/search/"> <i class="navbar-icon fas fa-search" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Search</span> </a> </li> </ul> </nav> </header>
    <div class="content">
      <article class="feature-image" >
    <header id="main" style="">
        <div class="title-padder">
            
                <h1 id="Raspberry+Pi.+Haciendo+copias+de+seguridad" class="title">Raspberry Pi. Haciendo copias de seguridad</h1>
                


<div class="post-info"><a href="https://github.com/vctrsnts" target="_blank" rel="noopener">
      <img alt="Author's avatar" src="/assets/img/avatar.jpg" loading="lazy">
    
    <p class="meta">
      VSANTOS - 
      
      Enero 17, 2021
    </p></a></div>

            
        </div>
    </header>

    <section class="post-content">
    
            <p>Otro capitulo más con respecto a la configuración de de mi RPI4, en este caso son las copias de seguridad de la información más importante.</p>

<!-- more -->

<p>Tal como he dicho en otros articulos, desde que conoci Docker, se abrio un nuevo mundo y para esto, no iba a ser menos.</p>

<p>Para realizar las copias de seguridad queria usar esta imagen <a href="https://hub.docker.com/r/pablokbs/rsnapshot-cron/tags?page=1&amp;ordering=last_updated" target="_blank">rsnapshot</a>, hecha por PeladoNerd, pero no funciona. 
No esta compilada para ARM, le di un toque por octubre, pero supongo que por trabajo, no ha podido solucionar el problema, asi que tuve que buscarme otras opciones. Y como no, salio al rescate 
<a href="https://hub.docker.com/r/linuxserver/rsnapshot" target="_blank">linuxserver</a>.</p>

<p>Lo bueno que tiene <strong>rsnapshot</strong> es que solamente te copia los ficheros que se modifican. Al principio, si que hace una copia de todo, porque no tiene nada con que comprarar, pero a partir de ese 
momento, solo hace las copias de los ficheros que se modifican.</p>

<p>Asi, que nos pusimos a ello. Lo primero fue decidir que información es la importante, luego como la vamos a estructurar (donde estara el directorio). En mi caso, la cosa quedo de la siguiente manera:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">   #</span><span class="c">## DIRECTORIO DONDE SE ALMACENAN LAS COPIAS DE SEGURIDAD</span>
<span class="go">   /mnt/seguretat

</span><span class="gp">   #</span><span class="c">## DIRECTORIOS DE LOS QUE QUIERO COPIAS DE SEGURIDAD</span>
<span class="gp">   #</span><span class="w"> </span>el directorio de mi usuario <span class="o">(</span>junto con el docker-compose de docker<span class="o">)</span>
<span class="go">   /home
</span><span class="gp">   #</span><span class="w"> </span>el directorio donde estan las configuraciones del servidor que son importantes
<span class="go">   /etc
</span><span class="gp">   #</span><span class="w"> </span>el directorio donde tengo las configuraciones de las imagenes de docker
<span class="go">   /mnt/config
</span></code></pre></div></div>

<p>Una vez ya tenemos decido la información a salvaguardar, pasamos a la creación del <strong>docker-compose</strong>:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">   rsnapshot:
    image: ghcr.io/linuxserver/rsnapshot
     container_name: rsnapshot
     restart: unless-stopped
     volumes:
      - /mnt/config/rsnapshot:/config
      - /mnt/seguretat:/snapshots
      - /etc:/data/etc
      - /home/pi:/data/home/pi
      - /mnt/config:/data/config
     environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Madrid
</span></code></pre></div></div>

<p>Después de crear el docker, solamente nos quedar ejecutar la magica instruccion que nos lo pondra en marcha todo:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">   usuari@raspberry:~$</span><span class="w"> </span>docker-compose up <span class="nt">-d</span> rsnapshot
</code></pre></div></div>

<p>Ahora nos queda la ultima parte, que es configurar los ficheros de configuración de rsnapshot. En mi caso lo hago dentro del mismo docker. Es posible que se pudiera hacer a traves de los ficheros de 
configuración que estan en el host del docker, pero prefiero acceder para hacer la configuración. Que en mi caso estan en <code class="language-plaintext highlighter-rouge">/mnt/config/rsnapshot</code> y a configuración la
 tengo de la siguiente manera:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">   usuari@raspberry:~$</span><span class="w"> </span><span class="nb">cd </span>dockerCompose
<span class="gp">   usuari@raspberry:~/dockerCompose $</span><span class="w"> </span>docker-compose <span class="nb">exec </span>rsnapshot sh
<span class="go">
</span><span class="gp">   #</span><span class="c">## EDITO LOS FICHEROS RSNAPSHOT.CONF DE LA SIGUIENTE MANERA</span>
<span class="gp">   #</span><span class="w"> </span>DIRECTORIO QUE CONTIENE LAS COPIAS <span class="o">(</span>QUE LO HABRAS CONFIGURADO EN EL
<span class="gp">   #</span><span class="w"> </span>DOCKER-COMPOSE<span class="o">)</span>
<span class="go">   rsnapshpot_root   /snapshots

</span><span class="gp">   #</span><span class="c">## SON LOS INTERVALOS QUE SE SALVAN</span>
<span class="gp">   #</span><span class="w"> </span>SE MANTIENEN 7 COPIAS DIARIAS
<span class="go">   retain    daily   7
</span><span class="gp">   #</span><span class="w"> </span>SE MANTIENEN 4 COPIAS SEMANALES
<span class="go">   retain    weekly  4
</span><span class="gp">   #</span><span class="w"> </span>SE MANTIENEN 3 COPIAS MENSUALES
<span class="go">   retain    monthly 3
  
</span><span class="gp">   #</span><span class="w"> </span>FICHERO DE LOGS  
<span class="go">   logfile   /config/rsnapshot.log
</span><span class="gp">   #</span><span class="w"> </span>DIRECTORIO A COPIAR - EN MI CASO, DENTRO DE DATA, TENGO LOS DIRECTORIOS
<span class="gp">   #</span><span class="w"> </span>A SALVAGUARDAR
<span class="go">   backup    /data/    localhost/
</span></code></pre></div></div>

<p>El siguiente fichero que hay que configurar, es el de cron (propio de rsnapshot), que se encarga de ejecutar las copias:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">   #</span><span class="w"> </span>AUN SIGO DENTRO DEL CONTAINER
<span class="go">   cd crontabs
   vi root
</span></code></pre></div></div>

<p>Y ahora modificamos el archivo</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">   #</span><span class="w"> </span>AHORA PASAMOS A LA EDICIÓN DEL FICHERO
<span class="gp">   #</span><span class="w"> </span>min   hour    day   month   weekday   <span class="nb">command</span>
<span class="gp">   #</span><span class="w"> </span>SE EJECUTA CADA DIA A LAS 2 DE LA MAÑANA
<span class="go">   0       2       *     *       *         rsnapshot daily
</span><span class="gp">   #</span><span class="w"> </span>SE EJECUTA CADA LUNES <span class="o">(</span>WEEKDAY - 1<span class="o">)</span> A LAS 4 DE LA MAÑANA
<span class="go">   0       4       *     *       1         rsnapshot weekly
</span><span class="gp">   #</span><span class="w"> </span>SE EJECUTA CADA DIA 1 DE CADA MES A LAS 6 DE LA MAÑANA
<span class="go">   0       6       1     *       *         rsnapshot monthly
</span></code></pre></div></div>

<p>Y con esto, ya tenemos configurado <strong>rsnapshot</strong>, ahora solamente hay que dejarlo que funcione y listo.</p>

<h4 id="referencia">Referencia</h4>
<ul>
  <li><a href="https://www.youtube.com/watch?v=gxJqpBsPseM" target="_blank">Backups faciles con Docker! - V2M / Rsnapshot</a></li>
  <li><a href="https://hub.docker.com/r/pablokbs/rsnapshot-cron/tags?page=1&amp;ordering=last_updated" target="_blank">PabloKbs - Rsnapshot</a></li>
  <li><a href="https://hub.docker.com/r/linuxserver/rsnapshot" target="_blank">LinuxServer - Rsnapshot</a></li>
</ul>

    
    </section>

    <!-- Social media shares -->
    
 
  




    <!-- Tag list -->
    
    


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags#Docker">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Docker</p>
        </a></li>
      
        <li><a class="button" href="/tags#Raspberry+Pi+OS">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Raspberry Pi OS</p>
        </a></li>
      
    </ul>
  </div>



</article>




<!-- To change color of links in the page --> <style> header#main { background-size: cover; background-repeat: no-repeat; background-position: center; } header#main { background-image: url('/assets/img/feature-img/logo_post.jpg'); } </style> <!-- Post navigation --> <div id="post-nav"> <div id="previous-post"> <a alt="Raspberry Pi. Externalizando copias de seguridad" href="/docker/raspberry%20pi%20os/2021/01/18/rpi-externalizando-copias-seguridad.html"> <p>Previous post</p> Raspberry Pi. Externalizando copias de seguridad </a> </div> <div id="next-post"> <a alt="Crear imagenes en docker" href="/docker/2020/12/14/crear-imagen-docker.html"> <p>Next post</p> Crear imagenes en docker </a> </div> </div> <!--Utterances--> <!-- Cusdis --> <!-- Disqus -->


    </div>
    
    <footer class="site-footer"> <ul> <a href="https://creativecommons.org/licenses/by-nc/4.0/deed.ca" title="This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"><i class="fab fa-creative-commons fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-by fa-stack fa-lg"></i></span><span class="fa-stack fa-lg"><i class="fab fa-creative-commons-nc-eu fa-stack fa-lg"></i></span> </a> </ul> <p class="text"> Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a> </p> <div class="footer-icons"> <ul> <!-- Social icons from Font Awesome, if enabled --> <li> <a feed.xml href="/feed.xml" title="Follow RSS feed" target="_blank"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://github.com/vctrsnts" title="Follow on Github" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://mastodon.online/@vsantos" title="Follow on Mastodon" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://vctrsnts.tumblr.com/" title="Follow on Tumblr" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-tumblr fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://vsantos.wordpress.com/" title="Follow on Wordpress" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-wordpress fa-stack-1x fa-inverse"></i> </span> </a> </li> </ul> </div> <script type="module"> mermaid.initialize({ startOnLoad: false, theme: "default" }); mermaid.run({ nodes: [...document.querySelectorAll('.language-mermaid'), ...document.querySelectorAll('.mermaid')] }); </script> </footer>
  </body>
</html>
